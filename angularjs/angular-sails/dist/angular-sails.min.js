!function(t,e){"use strict";t.module("ngSails",["ng"]),function(t,e){function n(e){var n,r,s,i={};return e?(t.forEach(e.split("\n"),function(t){s=t.indexOf(":"),n=lowercase(o(t.substr(0,s))),r=o(t.substr(s+1)),n&&(i[n]=i[n]?i[n]+", "+r:r)}),i):i}function o(e){return t.isString(e)?e.trim():e}function r(e){return e&&t.isFunction(e.then)}function s(e){var o=t.isObject(e)?e:void 0;return function(t){if(o||(o=n(e)),t){var r=o[lowercase(t)];return void 0===r&&(r=null),r}return o}}e.sails&&(e.sails.autoConnect=!1),t.module("ngSails").provider("$sails",function(){var n=this;this.httpVerbs=["get","post","put","delete"],this.eventNames=["on","off"],this.url=void 0,this.urlPrefix="",this.config={transports:["websocket","polling"],useCORSRouteToGetCookie:!1},this.debug=!1;var o=this.interceptors=[];this.$get=["$q","$injector","$rootScope","$log","$timeout",function(i,u,a,c,f){function l(t){function e(){o(null)}function o(e,o){o||(o={body:e,headers:e.headers||{},statusCode:e.statusCode||e.status||0,error:function(){return this.statusCode<200||this.statusCode>=400?this.body||this.statusCode:void 0}()}),o.data=o.body,o.status=o.statusCode,o.socket=g,o.url=t.url,o.method=t.method,o.config=t.config,o.error?(n.debug&&c.warn("$sails response "+o.statusCode+" "+t.url,o),s.reject(o)):(n.debug&&c.info("$sails response "+t.url,o),s.resolve(o))}var s=i.defer();return n.debug&&c.info("$sails "+t.method+" "+t.url,t.data||""),t.timeout>0?f(e,t.timeout):r(t.timeout)&&t.timeout.then(e),g["legacy_"+t.method.toLowerCase()](t.url,t.data,o),s.promise}function d(e){g["legacy_"+e]=g[e],g[e]=function(o,r,u){var a=[l,void 0],c=i.when({url:n.urlPrefix+o,data:r,socket:g,config:u||{},method:e.toUpperCase()});for(t.forEach(p,function(t){(t.request||t.requestError)&&a.unshift(t.request,t.requestError),(t.response||t.responseError)&&a.push(t.response,t.responseError)});a.length;){var f=a.shift(),d=a.shift();c=c.then(f,d)}return c.success=function(t){return c.then(function(e){t(e.body,e.statusCode,s(e.headers),e)}),c},c.error=function(t){return c.then(null,function(e){t(e.body,e.statusCode,s(e.headers),e)}),c},c}}function h(e){(g[e]||g._raw&&g._raw[e])&&(g["legacy_"+e]=g[e]||g._raw[e],g[e]=function(n,o){null!==o&&t.isFunction(o)&&g["legacy_"+e](n,function(t){a.$evalAsync(o.bind(g,t))})})}var g=(e.sails&&e.sails.connect||e.connect)(n.url,n.config);g.connect=function(e){if(!g.isConnected()){var o=e||{};o=t.extend({},n.config,e),g.useCORSRouteToGetCookie=o.useCORSRouteToGetCookie,g.url=o.url||n.url,g.multiplex=o.multiplex,g._connect()}return g};var p=[];return t.forEach(o,function(e){p.unshift(t.isString(e)?u.get(e):u.invoke(e))}),g.once=function(e,n){null!==n&&t.isFunction(n)&&g._raw&&g._raw.once(e,function(t){a.$evalAsync(n.bind(g,t))})},t.forEach(n.httpVerbs,d),t.forEach(n.eventNames,h),g.$modelUpdater=function(e,n){g.on(e,function(e){var o;switch(e.verb){case"created":n.push(e.data);break;case"updated":var r;for(o=0;o<n.length;o++)if(n[o].id===e.id){r=n[o];break}if(!r&&!e.previous)return;r||(r=e.previous,n.push(r)),t.extend(r,e.data);break;case"destroyed":for(o=0;o<n.length;o++)if(n[o].id===e.id){n.splice(o,1);break}}})},g}],this.$get.$inject=["$q","$injector","$rootScope","$log","$timeout"]})}(t,e)}(angular,io);